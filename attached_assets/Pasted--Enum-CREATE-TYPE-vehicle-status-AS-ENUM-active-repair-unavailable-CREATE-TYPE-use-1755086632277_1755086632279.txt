-- Enum типы
CREATE TYPE vehicle_status AS ENUM ('active', 'repair', 'unavailable');
CREATE TYPE user_role AS ENUM ('admin', 'manager', 'team_lead');
CREATE TYPE penalty_status AS ENUM ('open', 'paid');
CREATE TYPE maintenance_type AS ENUM ('inspection', 'repair');
CREATE TYPE material_type AS ENUM ('material', 'equipment');
CREATE TYPE material_status AS ENUM ('active', 'returned', 'broken');
CREATE TYPE expense_type AS ENUM ('vehicle', 'team');
CREATE TYPE material_event AS ENUM ('assigned', 'returned', 'broken');

-- Таблица пользователей
CREATE TABLE users (
    id UUID PRIMARY KEY,
    name TEXT,
    phone TEXT,
    role user_role,
    team_id UUID REFERENCES teams(id)
);

-- Таблица команд (бригад)
CREATE TABLE teams (
    id UUID PRIMARY KEY,
    name TEXT,
    lead_id UUID REFERENCES users(id),
    created_at TIMESTAMP
);

-- Таблица автомобилей
CREATE TABLE vehicles (
    id UUID PRIMARY KEY,
    name TEXT,
    license_plate TEXT UNIQUE,
    vin TEXT UNIQUE,
    status vehicle_status,
    created_at TIMESTAMP
);

-- Закрепление автомобилей за бригадами
CREATE TABLE vehicle_assignments (
    id UUID PRIMARY KEY,
    vehicle_id UUID REFERENCES vehicles(id),
    team_id UUID REFERENCES teams(id),
    start_date DATE,
    end_date DATE
);

-- Штрафы
CREATE TABLE penalties (
    id UUID PRIMARY KEY,
    vehicle_id UUID REFERENCES vehicles(id),
    user_id UUID REFERENCES users(id),
    date DATE,
    amount NUMERIC,
    photo_url TEXT,
    status penalty_status
);

-- Обслуживание/ремонт
CREATE TABLE maintenances (
    id UUID PRIMARY KEY,
    vehicle_id UUID REFERENCES vehicles(id),
    date DATE,
    type maintenance_type,
    description TEXT,
    receipt_url TEXT
);

-- Материалы
CREATE TABLE materials (
    id UUID PRIMARY KEY,
    name TEXT,
    type material_type,
    description TEXT
);

-- Учёт материалов, выданных бригаде
CREATE TABLE material_assignments (
    id UUID PRIMARY KEY,
    material_id UUID REFERENCES materials(id),
    team_id UUID REFERENCES teams(id),
    quantity INTEGER,
    start_date DATE,
    end_date DATE,
    status material_status
);

-- История материалов (лог)
CREATE TABLE material_history (
    id UUID PRIMARY KEY,
    material_id UUID REFERENCES materials(id),
    team_id UUID REFERENCES teams(id),
    date DATE,
    event material_event,
    description TEXT
);

-- Расходы
CREATE TABLE expenses (
    id UUID PRIMARY KEY,
    type expense_type,
    vehicle_id UUID REFERENCES vehicles(id),
    team_id UUID REFERENCES teams(id),
    date DATE,
    amount NUMERIC,
    description TEXT,
    receipt_url TEXT
);
