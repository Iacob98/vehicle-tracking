# –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π

**–î–∞—Ç–∞:** 2025-10-10
**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** Next.js 15.1.6 + Supabase
**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–æ–ª–∏ —Å 5 –¥–æ 4, –≤–Ω–µ–¥—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥ –∏ TCO –∞–Ω–∞–ª–∏—Ç–∏–∫—É

---

## 1. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ vs –¶–µ–ª–µ–≤–æ–µ

### –¢–µ–∫—É—â–∏–µ —Ä–æ–ª–∏ (5):
- üëë **Owner** - –≤–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- üîß **Admin** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã
- üíº **Manager** - –º–µ–Ω–µ–¥–∂–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π
- üë®‚Äçüíº **Team Lead** - –±—Ä–∏–≥–∞–¥–∏—Ä
- üë∑ **Worker** - —Ä–∞–±–æ—Ç–Ω–∏–∫

### –¶–µ–ª–µ–≤—ã–µ —Ä–æ–ª–∏ (4):
- üëë **–ê–¥–º–∏–Ω** (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç Owner + Admin) - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ
- üíº **–ú–µ–Ω–µ–¥–∂–µ—Ä** (Manager) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- üöó **–í–æ–¥–∏—Ç–µ–ª—å** (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç Team Lead + Worker) - –≤–æ–¥–∏—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–æ–º –∑–∞–ø—Ä–∞–≤–∫–∏/—à—Ç—Ä–∞—Ñ–æ–≤
- üëÅÔ∏è **–ü—Ä–æ—Å–º–æ—Ç—Ä** (–Ω–æ–≤–∞—è —Ä–æ–ª—å) - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ –ë–î:
‚úÖ –¢–∞–±–ª–∏—Ü–∞ `users` —Å –ø–æ–ª–µ–º `role` (—Ç–µ–∫—Å—Ç/enum)
‚úÖ –¢–∞–±–ª–∏—Ü—ã: `vehicles`, `teams`, `team_members`, `penalties`, `expenses`, `car_expenses`, `maintenance`, `documents`
‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ `organization_id`
‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º (Zod + react-hook-form)
‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–ø–∏—Å–∫–æ–≤

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
‚ùå –ù–æ–≤–∞—è —Ä–æ–ª—å "–ü—Ä–æ—Å–º–æ—Ç—Ä" (viewer)
‚ùå –ü–æ–ª–µ `driver_id` –≤ `car_expenses` –¥–ª—è —Å–≤—è–∑–∏ –∑–∞–ø—Ä–∞–≤–æ–∫ —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º
‚ùå –ê–Ω—Ç–∏-—Ñ—Ä–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ª–∏–º–∏—Ç—ã, —á–∞—Å—Ç–æ—Ç–∞, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚ùå TCO –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (Total Cost of Ownership)
‚ùå –ü—Ä–æ—Ü–µ—Å—Å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
‚ùå –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º –≤ UI

---

## 2. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

### 2.1 –ò–∑–º–µ–Ω–µ–Ω–∏–µ enum –¥–ª—è —Ä–æ–ª–µ–π

**–§–∞–π–ª:** `migrations/008_simplify_roles.sql`

```sql
-- –®–∞–≥ 1: –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ–ª–∏
BEGIN;

-- –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–∏–ø —Å –Ω–æ–≤—ã–º–∏ —Ä–æ–ª—è–º–∏
CREATE TYPE user_role_new AS ENUM ('admin', 'manager', 'driver', 'viewer');

-- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
ALTER TABLE users ADD COLUMN role_new user_role_new;

UPDATE users SET role_new =
  CASE
    WHEN role IN ('owner', 'admin') THEN 'admin'::user_role_new
    WHEN role = 'manager' THEN 'manager'::user_role_new
    WHEN role IN ('team_lead', 'worker') THEN 'driver'::user_role_new
    ELSE 'viewer'::user_role_new
  END;

-- –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Ç–∏–ø
ALTER TABLE users DROP COLUMN role;
ALTER TABLE users RENAME COLUMN role_new TO role;
ALTER TABLE users ALTER COLUMN role SET DEFAULT 'viewer';
ALTER TABLE users ALTER COLUMN role SET NOT NULL;

-- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Ç–∏–ø
DROP TYPE IF EXISTS user_role CASCADE;
ALTER TYPE user_role_new RENAME TO user_role;

COMMIT;
```

### 2.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è driver_id –≤ car_expenses

```sql
-- –î–ª—è —Å–≤—è–∑–∏ –∑–∞–ø—Ä–∞–≤–∫–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤–æ–¥–∏—Ç–µ–ª–µ–º (–∞–Ω—Ç–∏-—Ñ—Ä–æ–¥)
ALTER TABLE car_expenses
ADD COLUMN driver_id UUID REFERENCES users(id);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∑–∞–ø—Ä–∞–≤–æ–∫ –≤–æ–¥–∏—Ç–µ–ª—è
CREATE INDEX idx_car_expenses_driver_id ON car_expenses(driver_id);

-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
ALTER TABLE car_expenses
ADD COLUMN location_lat DECIMAL(10, 8),
ADD COLUMN location_lng DECIMAL(11, 8);

COMMENT ON COLUMN car_expenses.driver_id IS '–í–æ–¥–∏—Ç–µ–ª—å, –æ—Å—É—â–µ—Å—Ç–≤–∏–≤—à–∏–π —Ä–∞—Å—Ö–æ–¥ (–¥–ª—è –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥)';
COMMENT ON COLUMN car_expenses.location_lat IS '–®–∏—Ä–æ—Ç–∞ –º–µ—Å—Ç–∞ —Ä–∞—Å—Ö–æ–¥–∞ (GPS)';
COMMENT ON COLUMN car_expenses.location_lng IS '–î–æ–ª–≥–æ—Ç–∞ –º–µ—Å—Ç–∞ —Ä–∞—Å—Ö–æ–¥–∞ (GPS)';
```

### 2.3 –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –ª–∏–º–∏—Ç–æ–≤ –∏ –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥ –ø—Ä–∞–≤–∏–ª

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–º–∏—Ç–æ–≤ –∑–∞–ø—Ä–∞–≤–æ–∫ –ø–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º
CREATE TABLE IF NOT EXISTS fuel_limits (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID REFERENCES organizations(id) NOT NULL,
  vehicle_id UUID REFERENCES vehicles(id) NOT NULL,
  daily_limit DECIMAL(10,2) DEFAULT 100.00, -- –ú–∞–∫—Å–∏–º—É–º –≤ –¥–µ–Ω—å (‚Ç¨)
  weekly_limit DECIMAL(10,2) DEFAULT 500.00, -- –ú–∞–∫—Å–∏–º—É–º –≤ –Ω–µ–¥–µ–ª—é (‚Ç¨)
  max_tank_capacity DECIMAL(10,2) DEFAULT 80.00, -- –û–±—ä–µ–º –±–∞–∫–∞ (–ª–∏—Ç—Ä—ã)
  min_interval_hours INTEGER DEFAULT 12, -- –ú–∏–Ω–∏–º—É–º —á–∞—Å–æ–≤ –º–µ–∂–¥—É –∑–∞–ø—Ä–∞–≤–∫–∞–º–∏
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥
CREATE TABLE IF NOT EXISTS fraud_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID REFERENCES organizations(id) NOT NULL,
  expense_id UUID REFERENCES car_expenses(id) NOT NULL,
  alert_type TEXT NOT NULL, -- 'daily_limit', 'frequency', 'duplicate', 'amount'
  alert_message TEXT NOT NULL,
  severity TEXT DEFAULT 'warning', -- 'info', 'warning', 'critical'
  is_resolved BOOLEAN DEFAULT false,
  resolved_by UUID REFERENCES users(id),
  resolved_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è fuel_limits
ALTER TABLE fuel_limits ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view fuel limits in their organization" ON fuel_limits
FOR SELECT USING (organization_id IN (SELECT organization_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Admins and managers can manage fuel limits" ON fuel_limits
FOR ALL USING (
  organization_id IN (
    SELECT organization_id FROM users
    WHERE id = auth.uid() AND role IN ('admin', 'manager')
  )
);

-- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è fraud_alerts
ALTER TABLE fraud_alerts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view fraud alerts in their organization" ON fraud_alerts
FOR SELECT USING (organization_id IN (SELECT organization_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Admins and managers can manage fraud alerts" ON fraud_alerts
FOR ALL USING (
  organization_id IN (
    SELECT organization_id FROM users
    WHERE id = auth.uid() AND role IN ('admin', 'manager')
  )
);
```

---

## 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫ –ø–æ —Ä–æ–ª—è–º

### 3.1 –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–æ–ª–∏ "–ü—Ä–æ—Å–º–æ—Ç—Ä" (viewer)

**–§–∞–π–ª:** `migrations/009_viewer_role_policies.sql`

```sql
-- Viewer –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
BEGIN;

-- –î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É SELECT –¥–ª—è viewer
CREATE POLICY "Viewers can read vehicles" ON vehicles
FOR SELECT USING (
  organization_id IN (
    SELECT organization_id FROM users
    WHERE id = auth.uid() AND role = 'viewer'
  )
);

-- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü: teams, users, penalties, expenses,
-- car_expenses, maintenance, documents, team_members, vehicle_assignments

-- Viewer –ù–ï –º–æ–∂–µ—Ç INSERT/UPDATE/DELETE (—ç—Ç–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è)

COMMIT;
```

### 3.2 –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–æ–ª–∏ "–í–æ–¥–∏—Ç–µ–ª—å" (driver)

```sql
-- –í–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç:
-- - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏ –±—Ä–∏–≥–∞–¥—É
-- - –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–∞–≤–∫–∏ (car_expenses —Å category='fuel')
-- - –î–æ–±–∞–≤–ª—è—Ç—å —à—Ç—Ä–∞—Ñ—ã (penalties)
-- - –ù–ï –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –±—Ä–∏–≥–∞–¥—ã, —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ

CREATE POLICY "Drivers can add fuel expenses" ON car_expenses
FOR INSERT WITH CHECK (
  organization_id IN (SELECT organization_id FROM users WHERE id = auth.uid())
  AND category = 'fuel'
  AND driver_id = auth.uid()
);

CREATE POLICY "Drivers can add penalties" ON penalties
FOR INSERT WITH CHECK (
  organization_id IN (SELECT organization_id FROM users WHERE id = auth.uid())
  AND user_id = auth.uid()
);
```

### 3.3 –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è "–ú–µ–Ω–µ–¥–∂–µ—Ä" –∏ "–ê–¥–º–∏–Ω"

```sql
-- –ú–µ–Ω–µ–¥–∂–µ—Ä –∏ –ê–¥–º–∏–Ω - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø CRUD
-- (—É–∂–µ –µ—Å—Ç—å –≤ —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª–∏—Ç–∏–∫–∞—Ö, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ)

-- –ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–ª–∏—Ç–∏–∫–∏:
DROP POLICY IF EXISTS "Users can insert vehicles in their organization" ON vehicles;
CREATE POLICY "Admins and managers can insert vehicles" ON vehicles
FOR INSERT WITH CHECK (
  organization_id IN (
    SELECT organization_id FROM users
    WHERE id = auth.uid() AND role IN ('admin', 'manager')
  )
);
```

---

## 4. API Endpoints (–Ω–æ–≤—ã–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)

### 4.1 –ê–Ω—Ç–∏-—Ñ—Ä–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–§–∞–π–ª:** `app/api/car-expenses/validate/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ/–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–∞–≤–æ–∫ (–º–∏–Ω–∏–º—É–º N —á–∞—Å–æ–≤ –º–µ–∂–¥—É –∑–∞–ø—Ä–∞–≤–∫–∞–º–∏)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å—É–º–º—ã –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä–µ–º–∞ –±–∞–∫–∞ (–Ω–µ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞)
- –ó–∞–ø–∏—Å—å –∞–ª–µ—Ä—Ç–æ–≤ –≤ `fraud_alerts`

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/car-expenses/validate`

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "vehicle_id": "uuid",
  "driver_id": "uuid",
  "amount": 75.50,
  "date": "2025-10-10",
  "category": "fuel",
  "liters": 65.0
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "valid": true,
  "alerts": [
    {
      "type": "warning",
      "message": "–ó–∞–ø—Ä–∞–≤–∫–∞ –±–ª–∏–∑–∫–∞ –∫ –¥–Ω–µ–≤–Ω–æ–º—É –ª–∏–º–∏—Ç—É (80%)"
    }
  ]
}
```

### 4.2 TCO –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–§–∞–π–ª:** `app/api/analytics/tco/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –†–∞—Å—á–µ—Ç Total Cost of Ownership –ø–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—é
- –†–∞–∑–±–∏–≤–∫–∞: —Ç–æ–ø–ª–∏–≤–æ, —Ä–µ–º–æ–Ω—Ç, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞, —à—Ç—Ä–∞—Ñ—ã, –∞—Ä–µ–Ω–¥–∞
- –ó–∞ –ø–µ—Ä–∏–æ–¥ (–º–µ—Å—è—Ü, –∫–≤–∞—Ä—Ç–∞–ª, –≥–æ–¥)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/analytics/tco?vehicle_id=uuid&period=month`

**–û—Ç–≤–µ—Ç:**
```json
{
  "vehicle_id": "uuid",
  "vehicle_name": "Mercedes Sprinter",
  "period": "2025-10",
  "total_cost": 2450.80,
  "breakdown": {
    "fuel": 1200.00,
    "maintenance": 450.00,
    "repair": 500.00,
    "insurance": 200.00,
    "penalties": 100.80,
    "rental": 0.00
  },
  "cost_per_km": 0.45, // –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–µ–≥
  "alerts": ["–í—ã—Å–æ–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–º–æ–Ω—Ç"]
}
```

### 4.3 –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

**–§–∞–π–ª:** `app/api/vehicles/onboarding/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ—à–∞–≥–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–æ–º–µ—Ä, VIN)
- –®–∞–≥ 2: –î–æ–∫—É–º–µ–Ω—Ç—ã (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞, T√úV)
- –®–∞–≥ 3: –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–∞–≤–æ–∫
- –®–∞–≥ 4: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –±—Ä–∏–≥–∞–¥—É

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/vehicles/onboarding`

---

## 5. Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

### 5.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏

**–§–∞–π–ª:** `app/dashboard/users/new/UserForm.tsx`

**–û–±–Ω–æ–≤–∏—Ç—å:**
```tsx
<select name="role" defaultValue="viewer">
  <option value="admin">üëë –ê–¥–º–∏–Ω - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø</option>
  <option value="manager">üíº –ú–µ–Ω–µ–¥–∂–µ—Ä - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏</option>
  <option value="driver">üöó –í–æ–¥–∏—Ç–µ–ª—å - –ó–∞–ø—Ä–∞–≤–∫–∏ –∏ —à—Ç—Ä–∞—Ñ—ã</option>
  <option value="viewer">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä - –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ</option>
</select>
```

### 5.2 –§–æ—Ä–º–∞ –∑–∞–ø—Ä–∞–≤–∫–∏ —Å –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥

**–§–∞–π–ª:** `app/dashboard/car-expenses/new/FuelExpenseForm.tsx`

**–î–æ–±–∞–≤–∏—Ç—å:**
- –ü–æ–ª–µ "–í–æ–¥–∏—Ç–µ–ª—å" (–∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è role='driver')
- –ü–æ–ª–µ "–õ–∏—Ç—Ä—ã" (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—ä–µ–º–∞ –±–∞–∫–∞)
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ë–ª–æ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π (–µ—Å–ª–∏ API –≤–µ—Ä–Ω—É–ª –∞–ª–µ—Ä—Ç—ã)

**–ü—Ä–∏–º–µ—Ä:**
```tsx
{alerts.length > 0 && (
  <div className="bg-yellow-50 p-4 rounded">
    <h4>‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</h4>
    <ul>
      {alerts.map(alert => <li key={alert.type}>{alert.message}</li>)}
    </ul>
  </div>
)}
```

### 5.3 Dashboard TCO –≤–∏–¥–∂–µ—Ç

**–§–∞–π–ª:** `app/dashboard/analytics/TCOWidget.tsx`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:**
- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –æ–±—â–∏–º TCO –∑–∞ –º–µ—Å—è—Ü
- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–∑–±–∏–≤–∫–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ (Chart.js –∏–ª–∏ Recharts)
- –¢–æ–ø-3 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞"

### 5.4 –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–æ —Ä–æ–ª—è–º

**–§–∞–π–ª:** `components/RoleGuard.tsx`

**–°–æ–∑–¥–∞—Ç—å:**
```tsx
export function RoleGuard({
  allowedRoles,
  children
}: {
  allowedRoles: UserRole[],
  children: React.ReactNode
}) {
  const { user } = useUser();
  if (!allowedRoles.includes(user.role)) {
    return null;
  }
  return <>{children}</>;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
<RoleGuard allowedRoles={['admin', 'manager']}>
  <Button>–£–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</Button>
</RoleGuard>
```

### 5.5 –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–º–∞—Å—Ç–µ—Ä)

**–§–∞–π–ª:** `app/dashboard/vehicles/new/OnboardingWizard.tsx`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:**
- Multi-step —Ñ–æ—Ä–º–∞ (4 —à–∞–≥–∞)
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ (localStorage)

---

## 6. User Stories –ø–æ —Ä–æ–ª—è–º

### 6.1 –ê–¥–º–∏–Ω üëë
**–ú–æ–∂–µ—Ç:**
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Å–æ–∑–¥–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª–∏—Ç—å, –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å)
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –±—Ä–∏–≥–∞–¥–∞–º–∏ (—Å–æ–∑–¥–∞—Ç—å, –Ω–∞–∑–Ω–∞—á–∏—Ç—å –±—Ä–∏–≥–∞–¥–∏—Ä–∞, —É–¥–∞–ª–∏—Ç—å)
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ (–ø–æ–ª–Ω—ã–π CRUD + –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–∞–≤–æ–∫
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –∞–ª–µ—Ä—Ç—ã –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥
- ‚úÖ –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –∏ –æ—Ç—á–µ—Ç–∞–º
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
*–ê–¥–º–∏–Ω –ú–∞—Ä–∏—è –∑–∞—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É ‚Üí –í–∏–¥–∏—Ç dashboard —Å –∞–ª–µ—Ä—Ç–∞–º–∏ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∞–ª–µ—Ä—Ç ‚Üí –í–∏–¥–∏—Ç –≤–æ–¥–∏—Ç–µ–ª—è –∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—å ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—Ä–∞–≤–æ–∫ ‚Üí –°–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º ‚Üí –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –∞–ª–µ—Ä—Ç*

### 6.2 –ú–µ–Ω–µ–¥–∂–µ—Ä üíº
**–ú–æ–∂–µ—Ç:**
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å)
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –±—Ä–∏–≥–∞–¥–∞–º–∏ (—Å–æ–∑–¥–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–∞–∑–Ω–∞—á–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–∏)
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ (CRUD + –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å —à—Ç—Ä–∞—Ñ—ã, —Ä–∞—Å—Ö–æ–¥—ã, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥ (–Ω–µ –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã)
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ (TCO, —Ä–∞—Å—Ö–æ–¥—ã, —à—Ç—Ä–∞—Ñ—ã)
- ‚ùå –ù–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚ùå –ù–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
*–ú–µ–Ω–µ–¥–∂–µ—Ä –ò–≤–∞–Ω –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å ‚Üí –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Üí –ó–∞–ø–æ–ª–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Üí –ù–∞–∑–Ω–∞—á–∞–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–∞ –±—Ä–∏–≥–∞–¥—É "–î–∞–ª—å–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–∑–∫–∏" ‚Üí –£–≤–µ–¥–æ–º–ª—è–µ—Ç –±—Ä–∏–≥–∞–¥–∏—Ä–∞*

### 6.3 –í–æ–¥–∏—Ç–µ–ª—å üöó
**–ú–æ–∂–µ—Ç:**
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ—é –±—Ä–∏–≥–∞–¥—É
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–∞–≤–∫–∏ (car_expenses —Å category='fuel')
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å —à—Ç—Ä–∞—Ñ—ã (penalties –¥–ª—è —Å–µ–±—è)
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–≤–æ–∏—Ö –∑–∞–ø—Ä–∞–≤–æ–∫
- ‚ùå –ù–µ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã
- ‚ùå –ù–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚ùå –ù–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
*–í–æ–¥–∏—Ç–µ–ª—å –ü–µ—Ç—Ä –∑–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—å ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É" ‚Üí –í—ã–±–∏—Ä–∞–µ—Ç —Å–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) ‚Üí –í–≤–æ–¥–∏—Ç —Å—É–º–º—É 85‚Ç¨ –∏ 70 –ª–∏—Ç—Ä–æ–≤ ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "GPS" (–ø–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã) ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "–ë–ª–∏–∑–∫–æ –∫ –¥–Ω–µ–≤–Ω–æ–º—É –ª–∏–º–∏—Ç—É" ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç*

### 6.4 –ü—Ä–æ—Å–º–æ—Ç—Ä üëÅÔ∏è
**–ú–æ–∂–µ—Ç:**
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –±—Ä–∏–≥–∞–¥—ã
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
- ‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –∏ —à—Ç—Ä–∞—Ñ—ã (read-only)
- ‚ùå –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å —á—Ç–æ-–ª–∏–±–æ

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
*–ê—É–¥–∏—Ç–æ—Ä –°–æ—Ñ–∏—è –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø "–ü—Ä–æ—Å–º–æ—Ç—Ä" ‚Üí –ó–∞—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É ‚Üí –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –≤—Å–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Ä–∞—Å—Ö–æ–¥–æ–≤ ‚Üí –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª ‚Üí –ü–æ–∫–∏–¥–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É*

---

## 7. –ü—Ä–æ—Ü–µ—Å—Å—ã

### 7.1 –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
**–®–∞–≥–∏:**
1. **–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** –ù–∞–∑–≤–∞–Ω–∏–µ, –Ω–æ–º–µ—Ä, VIN, —Å—Ç–∞—Ç—É—Å, —Ç–∏–ø (–∞—Ä–µ–Ω–¥–∞/—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)
2. **–î–æ–∫—É–º–µ–Ω—Ç—ã:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), T√úV (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
3. **–õ–∏–º–∏—Ç—ã:** –û–±—ä–µ–º –±–∞–∫–∞, –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç, –Ω–µ–¥–µ–ª—å–Ω—ã–π –ª–∏–º–∏—Ç, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
4. **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã–±–æ—Ä –±—Ä–∏–≥–∞–¥—ã, –ø–µ—Ä–∏–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°–≤–æ–¥–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- ‚ùå –ù–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –±—Ä–∏–≥–∞–¥–∞

### 7.2 –ó–∞–ø—Ä–∞–≤–∫–∞ —Å –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥
**–®–∞–≥–∏:**
1. **–í–æ–¥–∏—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–∞–≤–∫—É:**
   - –ê–≤—Ç–æ–º–æ–±–∏–ª—å (–≤—ã–±–æ—Ä –∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –µ–º—É)
   - –°—É–º–º–∞ (‚Ç¨)
   - –õ–∏—Ç—Ä—ã
   - –î–∞—Ç–∞ (—Å–µ–≥–æ–¥–Ω—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

2. **Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
   - –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç (–Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏?)
   - –ù–µ–¥–µ–ª—å–Ω—ã–π –ª–∏–º–∏—Ç
   - –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–∞–≤–æ–∫ (–Ω–µ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ?)
   - –û–±—ä–µ–º –±–∞–∫–∞ (–Ω–µ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞?)
   - –î—É–±–ª–∏–∫–∞—Ç—ã (—Ç–∞–∫–∞—è –∂–µ —Å—É–º–º–∞ –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å?)

3. **–ï—Å–ª–∏ –µ—Å—Ç—å –∞–ª–µ—Ä—Ç—ã:**
   - ‚ö†Ô∏è Warning: –ø–æ–∫–∞–∑–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª—é, –Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
   - üî¥ Critical: –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
   - –ó–∞–ø–∏—Å—å –≤ `car_expenses`
   - –ó–∞–ø–∏—Å—å –∞–ª–µ—Ä—Ç–æ–≤ –≤ `fraud_alerts` (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É (–µ—Å–ª–∏ critical)

### 7.3 TCO –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
**–†–∞—Å—á–µ—Ç:**
```
TCO = Fuel + Maintenance + Repair + Insurance + Penalties + Rental
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –û–±—â–∏–π TCO –∑–∞ –ø–µ—Ä–∏–æ–¥
- TCO –Ω–∞ –∫–º (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–µ–≥)
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (pie chart)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º (+/- %)
- –¢–æ–ø-3 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª—è

**–ê–ª–µ—Ä—Ç—ã:**
- üî¥ TCO –≤—ã—Ä–æ—Å –Ω–∞ >30% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º
- ‚ö†Ô∏è –†–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–º–æ–Ω—Ç >50% –æ—Ç –æ–±—â–µ–≥–æ TCO
- ‚ÑπÔ∏è –ê–≤—Ç–æ–º–æ–±–∏–ª—å –≤ –∞—Ä–µ–Ω–¥–µ –¥–æ—Ä–æ–∂–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ

---

## 8. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è (–ø–æ—Ä—è–¥–æ–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è)

### –§–∞–∑–∞ 1: –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π (1-2 –¥–Ω—è)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π
**–ó–∞–¥–∞—á–∏:**
1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î: –∏–∑–º–µ–Ω–∏—Ç—å enum —Ä–æ–ª–µ–π
2. –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
3. –û–±–Ω–æ–≤–∏—Ç—å UI —Ñ–æ—Ä–º (–≤—ã–±–æ—Ä —Ä–æ–ª–∏)
4. –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–ª–µ–π (–∏–∫–æ–Ω–∫–∏, –Ω–∞–∑–≤–∞–Ω–∏—è)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –§–∞–∑–∞ 2: RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ —Ä–æ–ª—è–º (2-3 –¥–Ω—è)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π
**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–æ–ª–∏ "–ü—Ä–æ—Å–º–æ—Ç—Ä"
2. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–æ–ª–∏ "–í–æ–¥–∏—Ç–µ–ª—å"
3. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è "–ê–¥–º–∏–Ω" –∏ "–ú–µ–Ω–µ–¥–∂–µ—Ä"
4. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `RoleGuard` –¥–ª—è UI

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ viewer –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ driver –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–∞–≤–∫–∏ –∏ —à—Ç—Ä–∞—Ñ—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ manager –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

### –§–∞–∑–∞ 3: –ê–Ω—Ç–∏-—Ñ—Ä–æ–¥ —Å–∏—Å—Ç–µ–º–∞ (3-5 –¥–Ω–µ–π)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π
**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã `fuel_limits` –∏ `fraud_alerts`
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `driver_id` –≤ `car_expenses`
3. –°–æ–∑–¥–∞—Ç—å API `/api/car-expenses/validate`
4. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É –∑–∞–ø—Ä–∞–≤–∫–∏ (–¥–æ–±–∞–≤–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è, –ª–∏—Ç—Ä—ã, GPS)
5. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞/–º–µ–Ω–µ–¥–∂–µ—Ä–∞

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª–∏–º–∏—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–ª–µ—Ä—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

---

### –§–∞–∑–∞ 4: TCO –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (3-4 –¥–Ω—è)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π
**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å API `/api/analytics/tco`
2. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `TCOWidget` –¥–ª—è dashboard
3. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ TCO"
4. –î–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ (Chart.js –∏–ª–∏ Recharts)
5. –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV/PDF

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç—ã TCO
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç

---

### –§–∞–∑–∞ 5: –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (2-3 –¥–Ω—è)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ UX)
**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `OnboardingWizard`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å multi-step —Ñ–æ—Ä–º—É
3. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å API

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —à–∞–≥–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞

---

## 9. –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 11-17 –¥–Ω–µ–π (1 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫)

**–ü–æ —Ñ–∞–∑–∞–º:**
- –§–∞–∑–∞ 1 (–ú–∏–≥—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π): 1-2 –¥–Ω—è ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–æ
- –§–∞–∑–∞ 2 (RLS –ø–æ–ª–∏—Ç–∏–∫–∏): 2-3 –¥–Ω—è ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–æ
- –§–∞–∑–∞ 3 (–ê–Ω—Ç–∏-—Ñ—Ä–æ–¥): 3-5 –¥–Ω–µ–π ‚ö†Ô∏è –í–∞–∂–Ω–æ
- –§–∞–∑–∞ 4 (TCO –∞–Ω–∞–ª–∏—Ç–∏–∫–∞): 3-4 –¥–Ω—è ‚ö†Ô∏è –í–∞–∂–Ω–æ
- –§–∞–∑–∞ 5 (–û–Ω–±–æ—Ä–¥–∏–Ω–≥ UX): 2-3 –¥–Ω—è ‚ÑπÔ∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å:**
–§–∞–∑–∞ 1 ‚Üí –§–∞–∑–∞ 2 ‚Üí –§–∞–∑–∞ 3 ‚Üí –§–∞–∑–∞ 4

**–ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:**
–§–∞–∑–∞ 4 –∏ –§–∞–∑–∞ 5 (–µ—Å–ª–∏ 2 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)

---

## 10. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–æ–ª–µ–π
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –°–¥–µ–ª–∞—Ç—å backup –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –∫–æ–ø–∏–∏ –ë–î
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è

### –†–∏—Å–∫ 2: –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑—É–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –°–¥–µ–ª–∞—Ç—å –∞–ª–µ—Ä—Ç—ã —Ç–∏–ø–∞ "warning" (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ)
- –î–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

### –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–∞ TCO
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –ù–∏–∑–∫–æ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Redis –∏–ª–∏ Supabase Caching)
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å TCO –≤ —Ñ–æ–Ω–µ (background job)
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –ø–æ–ª—è `date`, `vehicle_id` –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

---

## 11. –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### –ë–î:
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [ ] –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç –Ω–æ–≤—ã–µ —Ä–æ–ª–∏
- [ ] –¢–∞–±–ª–∏—Ü—ã `fuel_limits` –∏ `fraud_alerts` —Å–æ–∑–¥–∞–Ω—ã
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã

### Backend:
- [ ] API `/api/car-expenses/validate` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API `/api/analytics/tco` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∏ –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ê–ª–µ—Ä—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ë–î

### Frontend:
- [ ] –§–æ—Ä–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–Ω–æ–≤—ã–µ —Ä–æ–ª–∏)
- [ ] `RoleGuard` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- [ ] –§–æ—Ä–º–∞ –∑–∞–ø—Ä–∞–≤–∫–∏ —Å –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] TCO –≤–∏–¥–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ dashboard
- [ ] –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è API
- [ ] E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω—Ç–∏-—Ñ—Ä–æ–¥ (—Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TCO API

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README —Å –Ω–æ–≤—ã–º–∏ —Ä–æ–ª—è–º–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–æ–≤—ã–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º

---

## 12. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (—Ä–µ—Ñ–µ—Ä–µ–Ω—Å)

### –ê–Ω—Ç–∏-—Ñ—Ä–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞ (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

```typescript
// app/api/car-expenses/validate/route.ts
export async function POST(request: Request) {
  const { vehicle_id, driver_id, amount, date, liters } = await request.json();

  // 1. –ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è
  const limits = await supabase
    .from('fuel_limits')
    .select('*')
    .eq('vehicle_id', vehicle_id)
    .single();

  const alerts = [];

  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
  const todayExpenses = await supabase
    .from('car_expenses')
    .select('amount')
    .eq('vehicle_id', vehicle_id)
    .eq('category', 'fuel')
    .gte('date', startOfDay(date));

  const dailyTotal = todayExpenses.reduce((sum, e) => sum + e.amount, 0) + amount;

  if (dailyTotal > limits.daily_limit) {
    alerts.push({
      type: 'critical',
      message: `–ü—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç: ${dailyTotal}‚Ç¨ / ${limits.daily_limit}‚Ç¨`
    });
  } else if (dailyTotal > limits.daily_limit * 0.8) {
    alerts.push({
      type: 'warning',
      message: `–ë–ª–∏–∑–∫–æ –∫ –¥–Ω–µ–≤–Ω–æ–º—É –ª–∏–º–∏—Ç—É: ${dailyTotal}‚Ç¨ / ${limits.daily_limit}‚Ç¨`
    });
  }

  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä–µ–º–∞ –±–∞–∫–∞
  if (liters > limits.max_tank_capacity) {
    alerts.push({
      type: 'critical',
      message: `–û–±—ä–µ–º –ø—Ä–µ–≤—ã—à–∞–µ—Ç –±–∞–∫: ${liters}–ª / ${limits.max_tank_capacity}–ª`
    });
  }

  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–æ—Ç—ã
  const lastFuel = await supabase
    .from('car_expenses')
    .select('date')
    .eq('vehicle_id', vehicle_id)
    .eq('category', 'fuel')
    .order('date', { ascending: false })
    .limit(1)
    .single();

  if (lastFuel) {
    const hoursSince = differenceInHours(new Date(date), new Date(lastFuel.date));
    if (hoursSince < limits.min_interval_hours) {
      alerts.push({
        type: 'warning',
        message: `–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç–∞—è –∑–∞–ø—Ä–∞–≤–∫–∞: ${hoursSince}—á / ${limits.min_interval_hours}—á`
      });
    }
  }

  return Response.json({
    valid: !alerts.some(a => a.type === 'critical'),
    alerts
  });
}
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø–ª–∞–Ω —è–≤–ª—è–µ—Ç—Å—è **–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∫ –¥–µ–π—Å—Ç–≤–∏—é**, –∞ –Ω–µ –∫–æ–¥–æ–º. –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏, API –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–æ —Ñ–∞–∑–∞–º.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å –§–∞–∑—ã 1 (–º–∏–≥—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π), —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–∑—ã.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ —Å –∫–æ–º–∞–Ω–¥–æ–π ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≤ —Ç—Ä–µ–∫–µ—Ä–µ ‚Üí –ù–∞—á–∞–ª–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –§–∞–∑—ã 1.
